<html lang="th"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>รายงานสถานการณ์คุณภาพอากาศ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        .container {
            padding: 20px;
        }
        #pm-widget {
            background-color: #ffffff;
            border-radius: 10px;
            padding: 20px;
            display: inline-block;
            margin: 20px 0;
        }
        #aqi-image-container {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto;
        }
        #aqi-image {
            width: 80%;
            height: auto;
        }
        .footer {
            margin-top: 20px;
        }
        .footer a {
            color: #0000EE;
            text-decoration: none;
        }
        .aqi-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #d3d3d3;
            border-radius: 10px;
            padding: 20px;
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
        }
        .aqi-number {
            background-color: #d3d3d3;
            padding: 10px;
            font-size: 24px;
            font-weight: bold;
            margin: 0;
            width: 100%;
            text-align: center;
        }
        .aqi-label {
            background-color: #ffffff;
            padding: 5px;
            font-size: 18px;
            margin: 0;
            width: 100%;
            text-align: center;
        }
        .risk-group {
            margin-top: 10px;
            color: black;
        }
        .risk-group span {
            color: red;
            font-weight: bold;
        }
        .header-group {
            display: inline-block;
            text-align: center;
            line-height: 0.2; /* หรือกำหนดค่าอื่น ๆ ตามต้องการ */
        }
    </style>
</head>
<body>
    <div class="container">
        <img src="https://www.tsm.go.th/wp-content/uploads/2021/01/Logo001-Copy-Copy-copy-1.png" alt="Logo" height="46.75" width="159.75">
        <div class="header-group">
            <h3>รายงานสถานการณ์คุณภาพอากาศ</h3>
            <h4>โรงพยาบาลสมเด็จพระเจ้าตากสินมหาราช จ.ตาก</h4>
            <p id="current-datetime">อัพเดตล่าสุด: 12 มกราคม 2568 เวลา 12:19:20</p>
        </div>
        
        <div id="pm-widget" style="background-color: rgb(253, 192, 78);">
            <div id="aqi-image-container">
                <img id="aqi-image" src="./aqi_icon/ic-face-yellow.svg" alt="Moderate">
            </div>
            <h1 id="pm-25">29</h1>
            <p>(ค่า PM2.5 ไม่ควรเกิน 37.5 มคก./ลบม.)</p>
            <h2 id="pm-title">คุณภาพอากาศปานกลาง</h2>
            <p id="pm-text">[ประชาชนทั่วไป] สามารถทำกิจกรรมกลางแจ้งได้ตามปกติ [ผู้ที่ต้องดูแลสุขภาพเป็นพิเศษ] หากมีอาการเบื้องต้น เช่น ไอ หายใจลำบาก ระคายเคือง ตา ควรลดระยะเวลาการทำกิจกรรมกลางแจ้ง</p>
            <p class="risk-group"><span>กลุ่มเสี่ยง</span>: เด็กเล็ก หญิงตั้งครรภ์ ผู้สูงอายุ และผู้มีโรคประจำตัว</p>
        </div>

        <div class="aqi-container">
            <p class="aqi-number" id="pm-aqi">66</p>
            <p class="aqi-label">AQI</p>
        </div>

        <div class="footer">
            <p>แหล่งข้อมูล <a href="https://www.cmuccdc.org/tsm" target="_blank">CCDC: Climate Change Data Center</a></p>
            <p>คลินิกมลพิษ กลุ่มงานอาชีวเวชกรรม</p>
            <p>พัฒนาระบบโดย ศุภฤกษ์ เนตรแก้ว นวก.โสตฯ,<br>น.ส.พรรณกมล มนตรี นวก.สาธารณสุขปฏิบัติการ</p>
        </div>
    </div>

    <script>
        function calculateAQI(Ci) {
            let Cmax, Cmin, Imax, Imin;

            if (Ci >= 0 && Ci <= 15) {
                Cmin = 0;
                Cmax = 15;
                Imax = 25;
                Imin = 0;
            } else if (Ci > 15 && Ci <= 25) {
                Cmin = 15.1;
                Cmax = 25;
                Imax = 50;
                Imin = 26;
            } else if (Ci > 25 && Ci <= 37.5) {
                Cmin = 25.1;
                Cmax = 37.5;
                Imax = 100;
                Imin = 51;
            } else if (Ci > 37.5 && Ci <= 75) {
                Cmin = 37.6;
                Cmax = 75;
                Imax = 200;
                Imin = 101;
            } else if (Ci > 75) {
                Cmin = 75.1;
                Cmax = 500;
                Imax = 500;
                Imin = 201;
            } else {
                throw new Error("Invalid PM2.5 concentration value");
            }

            const AQI = ((Imax - Imin) / (Cmax - Cmin)) * (Ci - Cmin) + Imin;
            return Math.round(AQI);
        }

        const aqiUrl = 'https://www.cmuccdc.org/api/ccdc/value/5030';

        function updateDateTime() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' };
            document.getElementById('current-datetime').textContent = `อัพเดตล่าสุด: ${now.toLocaleDateString('th-TH', options)}`;
        }

        setInterval(updateDateTime, 1000);
        updateDateTime();

        fetch(aqiUrl)
            .then(response => response.json())
            .then(data => {
                const aqi = calculateAQI(data.pm25);
                const rgbValue = data.th_color;
                const rgb = rgbValue.split(",");

                document.getElementById("pm-aqi").textContent = `${aqi}`;
                document.getElementById("current-datetime").textContent = `อัพเดตล่าสุด: ${data.log_datetime}`;
                document.getElementById("pm-25").textContent = `${data.pm25}`;
                document.getElementById("pm-title").textContent = `${data.th_title}`;
                document.getElementById("pm-text").textContent = `${data.th_caption}`;
                document.getElementById("pm-widget").style.backgroundColor = `rgb(${rgb[0]}, ${rgb[1]}, ${rgb[2]})`;

                const aqiImageElement = document.getElementById('aqi-image');
                if (aqi <= 50) {
                    aqiImageElement.src = './aqi_icon/ic-face-green.svg';
                    aqiImageElement.alt = 'Good';
                } else if (aqi <= 100) {
                    aqiImageElement.src = './aqi_icon/ic-face-yellow.svg';
                    aqiImageElement.alt = 'Moderate';
                } else if (aqi <= 200) {
                    aqiImageElement.src = './aqi_icon/ic-face-orange.svg';
                    aqiImageElement.alt = 'Unhealthy';
                } else {
                    aqiImageElement.src = './aqi_icon/ic-face-red.svg';
                    aqiImageElement.alt = 'Very Unhealthy';
                }
            })
            .catch(error => console.error(error));
    </script>


</body></html>
